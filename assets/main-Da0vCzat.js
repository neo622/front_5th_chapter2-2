import{r as f,j as e,c as E,R as I}from"./client-DD4c7S6m.js";const R=t=>t.product.price*t.quantity*(1-O(t)),O=t=>t.product.discounts.reduce((s,a)=>t.quantity>=a.quantity&&a.rate>s?a.rate:s,0),L=(t,s)=>{let a=0,n=0;t.forEach(r=>{const{price:i}=r.product,{quantity:p}=r;a+=i*p,n+=R(r)});let c=a-n;return s&&(s.discountType==="amount"?n=Math.max(0,n-s.discountValue):n*=1-s.discountValue/100,c=a-n),{totalBeforeDiscount:Math.round(a),totalAfterDiscount:Math.round(n),totalDiscount:Math.round(c)}};function S(t,s){const[a,n]=f.useState(()=>{try{const c=localStorage.getItem(t);return c?JSON.parse(c):s}catch{return s}});return f.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(a))}catch(c){console.warn("useLocalStorage error:",c)}},[t,a]),[a,n]}const Q=()=>{const[t,s]=S("cart",[]),[a,n]=S("coupon",null),c=o=>{const m=t.find(x=>x.product.id===o.id);return o.stock-((m==null?void 0:m.quantity)||0)};return{cart:t,addToCart:o=>{c(o)<=0||s(x=>x.find(l=>l.product.id===o.id)?x.map(l=>l.product.id===o.id?{...l,quantity:Math.min(l.quantity+1,o.stock)}:l):[...x,{product:o,quantity:1}])},removeFromCart:o=>{s(m=>m.filter(x=>x.product.id!==o))},updateQuantity:(o,m)=>{s(x=>x.map(h=>{if(h.product.id===o){const l=h.product.stock,d=Math.max(0,Math.min(m,l));return d>0?{...h,quantity:d}:null}return h}).filter(h=>h!==null))},applyCoupon:o=>{n(o)},calculateTotal:()=>L(t,a),selectedCoupon:a}},U=t=>{const[s,a]=f.useState(t);return{coupons:s,addCoupon:c=>{a(r=>[...r,c])}}},B=t=>{const[s,a]=f.useState(t);return{products:s,updateProduct:r=>{a(i=>i.map(p=>p.id===r.id?r:p))},addProduct:r=>{a(i=>[...i,r])}}},W=()=>{const[t,s]=f.useState(new Set),[a,n]=f.useState(null),[c,r]=f.useState({quantity:0,rate:0}),[i,p]=f.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[g,v]=f.useState(!1),[o,m]=f.useState({name:"",price:0,stock:0,discounts:[]});return{openProductIds:t,editingProduct:a,newDiscount:c,newCoupon:i,showNewProductForm:g,newProduct:o,setOpenProductIds:s,setEditingProduct:n,setNewDiscount:r,setNewCoupon:p,setShowNewProductForm:v,toggleProductAccordion:u=>{s(b=>{const j=new Set(b);return j.has(u)?j.delete(u):j.add(u),j})},setNewProduct:m,handleEditProduct:u=>{n({...u})},handleProductNameUpdate:(u,b)=>{if(a&&a.id===u){const j={...a,name:b};n(j)}},handlePriceUpdate:(u,b)=>{if(a&&a.id===u){const j={...a,price:b};n(j)}}}},y=({variant:t="primary",fullWidth:s=!1,className:a="",...n})=>{const c="px-3 py-2 rounded font-medium transition-all",r=s?"w-full":"",i={primary:"bg-blue-500 text-white hover:bg-blue-600",secondary:"bg-gray-300 text-gray-800 hover:bg-gray-400",danger:"bg-red-500 text-white hover:bg-red-600",success:"bg-green-500 text-white hover:bg-green-600",ghost:"bg-white text-blue-600 hover:bg-blue-100",textOnly:"bg-transparent text-black hover:underline"};return e.jsx("button",{className:`${c} ${i[t]} ${r} ${a}`,...n})},J=({cartItem:t,appliedDiscount:s,updateQuantity:a,removeFromCart:n})=>{const c=()=>{a(t.product.id,t.quantity+1)},r=()=>{a(t.product.id,t.quantity-1)};return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,s>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(y,{onClick:r,variant:"secondary",className:"px-2 py-1 mr-1",children:"-"}),e.jsx(y,{onClick:c,variant:"secondary",className:"px-2 py-1 mr-1",children:"+"}),e.jsx(y,{onClick:()=>n(t.product.id),variant:"danger",className:"px-2 py-1",children:"삭제"})]})]},t.product.id)},_=({product:t,remainingStock:s,maxDiscount:a,onAddToCart:n})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(a*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((c,r)=>e.jsxs("li",{children:[c.quantity,"개 이상: ",(c.rate*100).toFixed(0),"% 할인"]},r))}),e.jsx(y,{onClick:()=>n(t),variant:s>0?"primary":"secondary",fullWidth:!0,disabled:s<=0,className:s<=0?"text-gray-500 cursor-not-allowed":"",children:s>0?"장바구니에 추가":"품절"})]},t.id),q=({menu:t})=>{const s=t==="cart"?"장바구니":"관리자 페이지";return e.jsx("h1",{className:"text-3xl font-bold mb-6",children:s})},z=({products:t,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:c,updateQuantity:r,applyCoupon:i,calculateTotal:p,selectedCoupon:g}=Q(),v=d=>d.reduce((u,b)=>Math.max(u,b.rate),0),o=d=>{const u=a.find(b=>b.product.id===d.id);return d.stock-((u==null?void 0:u.quantity)||0)},{totalBeforeDiscount:m,totalAfterDiscount:x,totalDiscount:h}=p(),l=d=>{const{discounts:u}=d.product,{quantity:b}=d;let j=0;for(const k of u)b>=k.quantity&&(j=Math.max(j,k.rate));return j};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(q,{menu:"cart"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(d=>e.jsx(_,{product:d,remainingStock:o(d),maxDiscount:v(d.discounts),onAddToCart:n}))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:a.map(d=>e.jsx(J,{cartItem:d,appliedDiscount:l(d),updateQuantity:r,removeFromCart:c}))}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:d=>i(s[parseInt(d.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),s.map((d,u)=>e.jsxs("option",{value:u,children:[d.name," -"," ",d.discountType==="amount"?`${d.discountValue}원`:`${d.discountValue}%`]},d.code))]}),g&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",g.name,"(",g.discountType==="amount"?`${g.discountValue}원`:`${g.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",m.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",h.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",x.toLocaleString(),"원"]})]})]})]})]})]})},G=({product:t,index:s,isOpen:a,editingProduct:n,newDiscount:c,toggleProductAccordion:r,handleEditProduct:i,handleEditComplete:p,handleProductNameUpdate:g,handlePriceUpdate:v,handleStockUpdate:o,handleRemoveDiscount:m,handleAddDiscount:x,setNewDiscount:h})=>e.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs(y,{"data-testid":"toggle-button",onClick:()=>r(t.id),variant:"textOnly",fullWidth:!0,className:"text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),a&&e.jsx("div",{className:"mt-2",children:n&&n.id===t.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:n.name,onChange:l=>g(t.id,l.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:n.price,onChange:l=>v(t.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:n.stock,onChange:l=>o(t.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),n.discounts.map((l,d)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[l.quantity,"개 이상 구매 시 ",l.rate*100,"% 할인"]}),e.jsx(y,{onClick:()=>m(t.id,d),variant:"danger",className:"px-2 py-1",children:"삭제"})]},d)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:c.quantity,onChange:l=>h({...c,quantity:parseInt(l.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:c.rate*100,onChange:l=>h({...c,rate:parseInt(l.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx(y,{onClick:()=>x(t.id),variant:"primary",className:"w-1/3 p-2",children:"할인 추가"})]})]}),e.jsx(y,{onClick:p,variant:"success",className:"px-2 py-1 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[t.discounts.map((l,d)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[l.quantity,"개 이상 구매 시 ",l.rate*100,"% 할인"]})},d)),e.jsx(y,{"data-testid":"modify-button",onClick:()=>i(t),variant:"primary",className:"px-2 py-1 mt-2",children:"수정"})]})})]},t.id),H=({newCoupon:t,setNewCoupon:s,handleAddCoupon:a,coupons:n})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:c=>s({...t,name:c.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:c=>s({...t,code:c.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:c=>s({...t,discountType:c.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:c=>s({...t,discountValue:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx(y,{onClick:a,variant:"success",fullWidth:!0,className:"p-2",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:n.map((c,r)=>e.jsxs("div",{"data-testid":`coupon-${r+1}`,className:"bg-gray-100 p-2 rounded",children:[c.name," (",c.code,"):",c.discountType==="amount"?`${c.discountValue}원`:`${c.discountValue}%`," ","할인"]},r))})]})]}),K=({newProduct:t,setNewProduct:s,onSubmit:a})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:n=>s({...t,name:n.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:n=>s({...t,price:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:n=>s({...t,stock:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx(y,{onClick:a,variant:"primary",fullWidth:!0,className:"p-2",children:"추가"})]}),X=t=>{if(!t)return!1;const{name:s,price:a,stock:n,discounts:c}=t;return!(!s||typeof s!="string"||s.trim()===""||typeof a!="number"||isNaN(a)||a<=0||typeof n!="number"||isNaN(n)||n<0||!Array.isArray(c)||c.length===0||c.some(i=>typeof i.quantity!="number"||i.quantity<=0||typeof i.rate!="number"||i.rate<=0))},Y=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:c})=>{const{openProductIds:r,editingProduct:i,newDiscount:p,newCoupon:g,showNewProductForm:v,newProduct:o,setEditingProduct:m,setNewDiscount:x,setNewCoupon:h,setShowNewProductForm:l,toggleProductAccordion:d,setNewProduct:u,handleEditProduct:b,handleProductNameUpdate:j,handlePriceUpdate:k}=W(),A=()=>{i&&(X(i)&&alert("상품의 모든 칸을 입력해주세요"),a(i),m(null))},T=(w,C)=>{const N=t.find(P=>P.id===w);if(N){const P={...N,stock:C};a(P),m(P)}},D=w=>{const C=t.find(N=>N.id===w);if(C&&i){const N={...C,discounts:[...C.discounts,p]};a(N),m(N),x({quantity:0,rate:0})}},M=(w,C)=>{const N=t.find(P=>P.id===w);if(N){const P={...N,discounts:N.discounts.filter((se,$)=>$!==C)};a(P),m(P)}},F=()=>{c(g),h({name:"",code:"",discountType:"percentage",discountValue:0})},V=()=>{const w={...o,id:Date.now().toString()};n(w),u({name:"",price:0,stock:0,discounts:[]}),l(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(q,{menu:"admin"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(y,{onClick:()=>l(!v),variant:"success",className:"px-4 py-2 mb-4",children:v?"취소":"새 상품 추가"}),v&&e.jsx(K,{newProduct:o,setNewProduct:u,onSubmit:V}),e.jsx("div",{className:"space-y-2",children:t.map((w,C)=>e.jsx(G,{product:w,index:C,isOpen:r.has(w.id),editingProduct:i,newDiscount:p,toggleProductAccordion:d,handleEditProduct:b,handleEditComplete:A,handleProductNameUpdate:j,handlePriceUpdate:k,handleStockUpdate:T,handleRemoveDiscount:M,handleAddDiscount:D,setNewDiscount:x},C))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsx(H,{newCoupon:g,setNewCoupon:h,handleAddCoupon:F,coupons:s})]})]})]})},Z=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ee=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],te=()=>{const{products:t,updateProduct:s,addProduct:a}=B(Z),{coupons:n,addCoupon:c}=U(ee),[r,i]=f.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx(y,{onClick:()=>i(!r),variant:"ghost",className:"px-4 py-2",children:r?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:r?e.jsx(Y,{products:t,coupons:n,onProductUpdate:s,onProductAdd:a,onCouponAdd:c}):e.jsx(z,{products:t,coupons:n})})]})};E.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(te,{})}));
